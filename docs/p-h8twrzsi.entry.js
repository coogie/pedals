import{r as t,h as s,H as i,g as o,c as e}from"./p-a1608285.js";class h{constructor(s){t(this,s)}render(){return s("div",{class:"app-home"},s("board-oscilloscope",null,s("pedal-board",null)))}static get style(){return".app-home{padding:10px}button{background:#5851ff;color:#fff;margin:8px;border:none;font-size:13px;font-weight:700;text-transform:uppercase;padding:16px 20px;border-radius:2px;-webkit-box-shadow:0 8px 16px rgba(0,0,0,.1),0 3px 6px rgba(0,0,0,.08);box-shadow:0 8px 16px rgba(0,0,0,.1),0 3px 6px rgba(0,0,0,.08);outline:0;letter-spacing:.04em;-webkit-transition:all .15s ease;transition:all .15s ease;cursor:pointer}button:hover{-webkit-box-shadow:0 3px 6px rgba(0,0,0,.1),0 1px 3px rgba(0,0,0,.1);box-shadow:0 3px 6px rgba(0,0,0,.1),0 1px 3px rgba(0,0,0,.1);-webkit-transform:translateY(1px);transform:translateY(1px)}"}}var a=function(t,s){if(void 0===s&&(s={}),!(t instanceof window.AudioNode))throw new Error("Oscilloscope source must be an AudioNode");t instanceof window.AnalyserNode?this.analyser=t:(this.analyser=t.context.createAnalyser(),t.connect(this.analyser)),s.fftSize&&(this.analyser.fftSize=s.fftSize),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.drawRequest=0};a.prototype.animate=function(t,s,i,o,e){var h=this;if(this.drawRequest)throw new Error("Oscilloscope animation is already running");this.ctx=t;var a=function(){t.clearRect(0,0,t.canvas.width,t.canvas.height),h.draw(t,s,i,o,e),h.drawRequest=window.requestAnimationFrame(a)};a()},a.prototype.stop=function(){this.drawRequest&&(window.cancelAnimationFrame(this.drawRequest),this.drawRequest=0,this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height))},a.prototype.draw=function(t,s,i,o,e){void 0===s&&(s=0),void 0===i&&(i=0),void 0===o&&(o=t.canvas.width-s),void 0===e&&(e=t.canvas.height-i),this.analyser.getByteTimeDomainData(this.timeDomain);var h=o/this.timeDomain.length;t.beginPath();for(var a=0;a<this.timeDomain.length;a+=2)t.lineTo(s+a*h,i+e*(this.timeDomain[a]/256));t.stroke()};const n={context:new(window.AudioContext||window.webkitAudioContext)({latencyHint:"playback"}),sources:[],pedals:[],lastInLine:null,toggleOnOff:(t,s)=>i=>{(void 0===i?t.gain.value:i)?(s.gain.value=1,t.gain.value=0):(s.gain.value=0,t.gain.value=1)},createSwitch(t,s,i=!1){const o=this.context.createGain(),e=this.context.createGain(),h=this.context.createGain(),a=this.toggleOnOff(o,e);return a(i),t.connect(o),s.connect(e),o.connect(h),e.connect(h),[h,a]},addPedal(t){this.pedals.push(t)},sealPedalBoard(){const t=this.context.createGain();for(let s of this.sources){let i;const{name:o}=s.constructor;"HTMLAudioElement"===o&&(i=this.context.createMediaElementSource(s)),"LocalMediaStream"!==o&&"MediaStream"!==o||(i=this.context.createMediaStreamSource(s)),i.connect(t)}const s=this.pedals.reduce((t,s)=>s(t),t);this.lastInLine=s,s.connect(this.context.destination)}};class l{constructor(s){t(this,s)}componentDidLoad(){new a(n.lastInLine).animate(this.canvas.getContext("2d"))}render(){return s(i,null,s("canvas",{class:"board-oscilloscope",ref:t=>this.canvas=t}),s("slot",null))}static get style(){return"canvas{border-top:2px solid red;border-bottom:2px solid red;height:85px;width:100%}"}}class r{constructor(s){t(this,s),this.playing=!1,this.usingLine=!1,this.demoFileNodes=[]}async componentWillLoad(){const t=["FloatingRotary","NoFear","OrangeDrive","TheSeventies","TombComb","VintageCombo"],s=document.createDocumentFragment();for(let s of t){const t=document.createElement("audio");t.src=`assets/audio/${s}.mp3`,t.id=s,t.loop=!0,this.demoFileNodes.push(t),n.sources.push(t)}this.el.appendChild(s);try{const t={video:!1,audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}},s=await navigator.mediaDevices.getUserMedia(t);this.lineNode=s,n.sources.push(s),this.lineNode.getAudioTracks()[0].enabled=!1}catch(t){}this.setActiveAudioNode(0)}setActiveAudioNode(t){this.togglePlaying("pause"),this.audioNode=this.demoFileNodes[t]}componentDidLoad(){n.sealPedalBoard()}togglePlaying(t=null){if(!this.audioNode)return;const s=n.context;return"suspended"===s.state&&s.resume(),this.usingLine&&this.toggleLineIn("stop"),"play"===t?(this.audioNode.play(),void(this.playing=!0)):"pause"===t?(this.audioNode.pause(),void(this.playing=!1)):this.playing?this.playing?(this.audioNode.pause(),void(this.playing=!1)):void 0:(this.audioNode.play(),void(this.playing=!0))}toggleLineIn(t=null){const s=this.lineNode.getAudioTracks()[0];return this.playing&&this.togglePlaying("pause"),"stop"===t?(this.usingLine=!1,void(s.enabled=!1)):"start"===t?(this.usingLine=!0,void(s.enabled=!0)):this.usingLine?(this.usingLine=!1,void(s.enabled=!1)):this.usingLine?void 0:(this.usingLine=!0,void(s.enabled=!0))}render(){return s("div",{class:"PedalBoard"},s("select",{onChange:t=>this.setActiveAudioNode(t.target.value)},this.demoFileNodes.map((t,i)=>s("option",{value:i},t.id))),s("button",{onClick:()=>this.togglePlaying()},this.playing?"⏸️":"▶️")," ","|"," ",s("button",{onClick:()=>this.toggleLineIn()},this.usingLine?"Stop":"Use"," Line In"),s("div",{class:"PedalBoard__pedals"},s("pedal-chorus",null),s("pedal-boost",null),s("pedal-overdrive",null)))}get el(){return o(this)}static get style(){return".PedalBoard__pedals{display:-ms-flexbox;display:flex}.PedalBoard__pedals>*{border:1px solid;margin:1em}"}}class d{constructor(s){t(this,s),this.active=!1,this.boost=1.5}componentWillLoad(){n.addPedal(t=>{const s=n.context,i=s.createGain(),o=s.createGain(),[e,h]=n.createSwitch(t,i,this.active);return this.toggle=h,this.boostNode=o,this.updateNodeValues(),t.connect(o),o.connect(i),e})}updateNodeValues(){this.boostNode.gain.value=this.boost}setKnobValue(t){const{id:s,val:i}=t.detail;"boost_knob"===s&&(this.boost=i),this.updateNodeValues()}toggleActive(){this.active=!this.active,this.toggle()}render(){return s("div",{class:"pedal-boost"},s("h1",null,"<pedal-boost>"),s("pedal-knob",{label:"Boost",min:0,max:3,value:this.boost,onRotate:t=>this.setKnobValue(t)}),s("pedal-stomp",{isActive:this.active,onStomp:()=>this.toggleActive()}))}static get style(){return""}}class c{constructor(s){t(this,s),this.active=!1,this.speed=1,this.delay=.03,this.depth=.25}componentWillLoad(){n.addPedal(t=>{const s=n.context,i=s.createGain(),o=s.createGain();this.delayNode1=s.createDelay(),this.delayNode2=s.createDelay(),this.delayNode3=s.createDelay(),this.delaySum=s.createGain(),this.oscillator=s.createOscillator();const[e,h]=n.createSwitch(t,i,this.active);return this.toggle=h,this.updateNodeValues(),t.connect(o),this.oscillator.connect(o),o.connect(this.delayNode1),o.connect(this.delayNode2),o.connect(this.delayNode3),this.delayNode1.connect(this.delaySum),this.delayNode2.connect(this.delaySum),this.delayNode3.connect(this.delaySum),this.delaySum.connect(i),t.connect(i),this.oscillator.start(0),e})}updateNodeValues(){this.delayNode1.delayTime.value=this.delay,this.delayNode2.delayTime.value=1.1*this.delay,this.delayNode3.delayTime.value=1.25*this.delay,this.delaySum.gain.value=this.depth,this.oscillator.frequency.value=this.speed}setKnobValue(t){const{id:s,val:i}=t.detail;"speed_knob"===s&&(this.speed=i),"delay_knob"===s&&(this.delay=i),"depth_knob"===s&&(this.depth=i),this.updateNodeValues()}toggleActive(){this.active=!this.active,this.toggle()}render(){return s("div",{class:"pedal-chorus"},s("h1",null,"<pedal-chorus>"),s("pedal-knob",{label:"Speed",min:.2,max:3,value:this.speed,onRotate:t=>this.setKnobValue(t)}),s("pedal-knob",{label:"Delay",min:.005,max:.075,value:this.delay,onRotate:t=>this.setKnobValue(t)}),s("pedal-knob",{label:"Depth",min:.05,max:.25,value:this.depth,onRotate:t=>this.setKnobValue(t)}),s("pedal-stomp",{isActive:this.active,onStomp:()=>this.toggleActive()}))}static get style(){return""}}class u{constructor(s){t(this,s),this.max=1,this.min=0,this.step="any",this.value=0,this.rotate=e(this,"rotate",7)}inputHandler(t){const s=parseFloat(t.target.value),i=`${this.label.toLowerCase()}_knob`;this.rotate.emit({id:i,val:s})}render(){return s("div",{class:"pedal-knob"},s("label",{htmlFor:"knob"},this.label),s("input",{type:"range",min:this.min,max:this.max,step:this.step,value:this.value,onInput:t=>this.inputHandler(t)}))}static get style(){return""}}class p{constructor(s){t(this,s),this.active=!1,this.lowPassFreq=5200,this.drive=18}componentWillLoad(){n.addPedal(t=>{const s=n.context,i=s.createGain();this.lowPassNode=s.createBiquadFilter(),this.overdriveNode=s.createWaveShaper();const[o,e]=n.createSwitch(t,i,this.active);return this.toggle=e,i.gain.value=1.175,this.overdriveNode.oversample="4x",this.lowPassNode.type="lowpass",this.updateNodeValues(),t.connect(this.overdriveNode),this.overdriveNode.connect(this.lowPassNode),this.lowPassNode.connect(i),o})}makeDistortionCurve(t){const s=new Float32Array(44100),i=Math.PI/180;let o,e=0;for(;e<44100;++e)s[e]=(3+t)*(o=2*e/44100-1)*57*i/(Math.PI+t*Math.abs(o));return s}setDriveValue(t){const s=parseFloat(t.detail);this.drive=s}updateNodeValues(){this.overdriveNode.curve=this.makeDistortionCurve(this.drive),this.lowPassNode.frequency.value=this.lowPassFreq}setKnobValue(t){const{id:s,val:i}=t.detail;"drive_knob"===s&&(this.drive=i),"tone_knob"===s&&(this.lowPassFreq=i),this.updateNodeValues()}toggleActive(){this.active=!this.active,this.toggle()}render(){return s("div",{class:"pedal-overdrive"},s("h1",null,"<pedal-overdrive>"),s("pedal-knob",{label:"Drive",min:10,max:50,value:this.drive,onRotate:t=>this.setKnobValue(t)}),s("pedal-knob",{label:"Tone",min:3500,max:7500,value:this.lowPassFreq,onRotate:t=>this.setKnobValue(t)}),s("pedal-stomp",{isActive:this.active,onStomp:()=>this.toggleActive()}))}static get style(){return""}}var v,m=(function(t){!function(){var s={}.hasOwnProperty;function i(){for(var t=[],o=0;o<arguments.length;o++){var e=arguments[o];if(e){var h=typeof e;if("string"===h||"number"===h)t.push(e);else if(Array.isArray(e)&&e.length){var a=i.apply(null,e);a&&t.push(a)}else if("object"===h)for(var n in e)s.call(e,n)&&e[n]&&t.push(n)}}return t.join(" ")}t.exports?(i.default=i,t.exports=i):window.classNames=i}()}(v={exports:{}}),v.exports);class b{constructor(s){t(this,s),this.isActive=!1,this.stomp=e(this,"stomp",7)}stompHandler(){this.stomp.emit()}render(){const t=m("PedalStomp",{"PedalStomp--active":this.isActive});return s("div",{class:t},s("div",{class:"PedalStomp__led"}),s("button",{class:"PedalStomp__switch",onClick:()=>this.stompHandler()},"Toggle"))}static get style(){return":host{--led:#48b2ee}.PedalStomp__switch{background:#464646;border:0;border-top:1px solid rgba(0,0,0,.15);border-radius:3px;font-size:0;height:120px;position:relative;width:100%}.PedalStomp__switch:after,.PedalStomp__switch:before{border-radius:10px;content:\"\";height:4px;position:absolute;top:15px;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);width:80%}.PedalStomp__switch:before{background:#343434;border-top:1px solid rgba(0,0,0,.25);border-bottom:1px solid hsla(0,0%,100%,.25);border-right:2px solid hsla(0,0%,100%,.25);border-left:2px solid rgba(0,0,0,.25)}.PedalStomp__switch:hover{cursor:pointer}.PedalStomp--active .PedalStomp__switch{background:#fafafa;background:-webkit-gradient(linear,left top,left bottom,from(#424242),color-stop(85%,#252525),to(#020202));background:linear-gradient(180deg,#424242 0,#252525 85%,#020202)}.PedalStomp--active .PedalStomp__switch:before{background:var(--led)}.PedalStomp--active .PedalStomp__switch:after{-webkit-box-shadow:0 -1px 5px var(--led),-1px 0 5px var(--led),1px 0 5px var(--led),0 1px 5px hsla(0,0%,100%,.25);box-shadow:0 -1px 5px var(--led),-1px 0 5px var(--led),1px 0 5px var(--led),0 1px 5px hsla(0,0%,100%,.25);opacity:.25}"}}export{h as app_home,l as board_oscilloscope,r as pedal_board,d as pedal_boost,c as pedal_chorus,u as pedal_knob,p as pedal_overdrive,b as pedal_stomp};